{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _wrapNativeSuper from \"@babel/runtime/helpers/wrapNativeSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport { $window, $XMLHttpRequest } from './mini-adapter';\n\nvar AJAXError = function (_Error) {\n  _inherits(AJAXError, _Error);\n\n  var _super = _createSuper(AJAXError);\n\n  function AJAXError(message, status, url) {\n    var _this;\n\n    _classCallCheck(this, AJAXError);\n\n    _this = _super.call(this, message);\n\n    _defineProperty(_assertThisInitialized(_this), \"status\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"url\", void 0);\n\n    _this.status = status;\n    _this.url = url;\n    _this.name = _this.constructor.name;\n    _this.message = message;\n    return _this;\n  }\n\n  _createClass(AJAXError, [{\n    key: \"toString\",\n    value: function toString() {\n      return \"\".concat(this.name, \": \").concat(this.message, \" (\").concat(this.status, \"): \").concat(this.url);\n    }\n  }]);\n\n  return AJAXError;\n}(_wrapNativeSuper(Error));\n\nfunction makeRequest(requestParameters) {\n  var xhr = new $XMLHttpRequest();\n  xhr.open('GET', requestParameters.url, true);\n\n  for (var k in requestParameters.headers) {\n    if (requestParameters.headers.hasOwnProperty(k)) {\n      xhr.setRequestHeader(k, requestParameters.headers[k]);\n    }\n  }\n\n  xhr.withCredentials = requestParameters.credentials === 'include';\n  return xhr;\n}\n\nexport var getJSON = function getJSON(requestParameters, callback) {\n  var xhr = makeRequest(requestParameters);\n  xhr.setRequestHeader('Accept', 'application/json');\n\n  xhr.onerror = function () {\n    callback(new Error(xhr.statusText));\n  };\n\n  xhr.onload = function () {\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      var data;\n\n      try {\n        data = JSON.parse(xhr.response);\n      } catch (err) {\n        return callback(err);\n      }\n\n      callback(null, data);\n    } else {\n      if (xhr.status === 401) {\n        callback(new AJAXError(\"\".concat(xhr.statusText), xhr.status, requestParameters.url));\n      } else {\n        callback(new AJAXError(xhr.statusText, xhr.status, requestParameters.url));\n      }\n    }\n  };\n\n  xhr.send();\n  return xhr;\n};\nexport var getArrayBuffer = function getArrayBuffer(requestParameters, callback) {\n  var xhr = makeRequest(requestParameters);\n  xhr.responseType = 'arraybuffer';\n\n  xhr.onerror = function () {\n    callback(new Error(xhr.statusText));\n  };\n\n  xhr.onload = function () {\n    var response = xhr.response;\n\n    if (response.byteLength === 0 && xhr.status === 200) {\n      return callback(new Error('http status 200 returned without content.'));\n    }\n\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      callback(null, {\n        data: response,\n        cacheControl: xhr.getResponseHeader('Cache-Control'),\n        expires: xhr.getResponseHeader('Expires')\n      });\n    } else {\n      callback(new AJAXError(xhr.statusText, xhr.status, requestParameters.url));\n    }\n  };\n\n  xhr.send();\n  return xhr;\n};\n\nfunction sameOrigin(url) {\n  var a = $window.document.createElement('a');\n  a.href = url;\n  return a.protocol === $window.document.location.protocol && a.host === $window.document.location.host;\n}\n\nvar transparentPngUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\nexport var getImage = function getImage(requestParameters, callback) {\n  return getArrayBuffer(requestParameters, function (err, imgData) {\n    if (err) {\n      callback(err);\n    } else if (imgData) {\n      var img = new $window.Image();\n      img.crossOrigin = 'anonymous';\n      var URL = $window.URL || $window.webkitURL;\n\n      img.onload = function () {\n        callback(null, img);\n        URL.revokeObjectURL(img.src);\n      };\n\n      var blob = new $window.Blob([new Uint8Array(imgData.data)], {\n        type: 'image/png'\n      });\n      img.src = imgData.data.byteLength ? URL.createObjectURL(blob) : transparentPngUrl;\n    }\n  });\n};","map":null,"metadata":{},"sourceType":"module"}