{"ast":null,"code":"import { __assign, __spreadArrays } from \"tslib\";\nimport { each } from '@antv/util';\nimport { interaction, theme, state } from '../../adaptor/common';\nimport { flow, pick } from '../../utils';\nimport { polygon, edge } from '../../adaptor/geometries';\nimport { chordLayout } from '../../utils/transform/chord';\nimport { getAllGeometriesRecursively, transformDataToNodeLinkData } from '../../utils';\nimport { X_FIELD, Y_FIELD, NODE_COLOR_FIELD, EDGE_COLOR_FIELD } from './constant';\n\nfunction transformData(params) {\n  // 将弦图数据放到ext中，nodeGeometry edgeGeometry使用\n  var options = params.options;\n  var data = options.data,\n      sourceField = options.sourceField,\n      targetField = options.targetField,\n      weightField = options.weightField,\n      nodePaddingRatio = options.nodePaddingRatio,\n      nodeWidthRatio = options.nodeWidthRatio,\n      _a = options.rawFields,\n      rawFields = _a === void 0 ? [] : _a; // 将数据转换为node link格式\n\n  var chordLayoutInputData = transformDataToNodeLinkData(data, sourceField, targetField, weightField);\n\n  var _b = chordLayout({\n    weight: true,\n    nodePaddingRatio: nodePaddingRatio,\n    nodeWidthRatio: nodeWidthRatio\n  }, chordLayoutInputData),\n      nodes = _b.nodes,\n      links = _b.links; // 1. 生成绘制node使用数据\n\n\n  var nodesData = nodes.map(function (node) {\n    return __assign(__assign({}, pick(node, __spreadArrays(['id', 'x', 'y', 'name'], rawFields))), {\n      isNode: true\n    });\n  }); // 2. 生成 edge 使用数据 （同桑基图）\n\n  var edgesData = links.map(function (link) {\n    return __assign(__assign({\n      source: link.source.name,\n      target: link.target.name,\n      name: link.source.name || link.target.name\n    }, pick(link, __spreadArrays(['x', 'y', 'value'], rawFields))), {\n      isNode: false\n    });\n  });\n  return __assign(__assign({}, params), {\n    ext: __assign(__assign({}, params.ext), {\n      // 将chordData放到ext中，方便下面的geometry使用\n      chordData: {\n        nodesData: nodesData,\n        edgesData: edgesData\n      }\n    })\n  });\n}\n/**\n * scale配置\n * @param params 参数\n */\n\n\nfunction scale(params) {\n  var _a;\n\n  var chart = params.chart;\n  chart.scale((_a = {\n    x: {\n      sync: true,\n      nice: true\n    },\n    y: {\n      sync: true,\n      nice: true,\n      max: 1\n    }\n  }, _a[NODE_COLOR_FIELD] = {\n    sync: 'color'\n  }, _a[EDGE_COLOR_FIELD] = {\n    sync: 'color'\n  }, _a));\n  return params;\n}\n/**\n * axis配置\n * @param params 参数\n */\n\n\nfunction axis(params) {\n  var chart = params.chart;\n  chart.axis(false);\n  return params;\n}\n/**\n * legend配置\n * @param params 参数\n */\n\n\nfunction legend(params) {\n  var chart = params.chart;\n  chart.legend(false);\n  return params;\n}\n/**\n * tooltip配置\n * @param params 参数\n */\n\n\nfunction tooltip(params) {\n  var chart = params.chart,\n      options = params.options;\n  var tooltip = options.tooltip;\n  chart.tooltip(tooltip);\n  return params;\n}\n/**\n * coordinate配置\n * @param params 参数\n */\n\n\nfunction coordinate(params) {\n  var chart = params.chart;\n  chart.coordinate('polar').reflect('y');\n  return params;\n}\n/**\n * nodeGeometry配置\n * @param params 参数\n */\n\n\nfunction nodeGeometry(params) {\n  // node view\n  var chart = params.chart,\n      options = params.options;\n  var nodesData = params.ext.chordData.nodesData;\n  var nodeStyle = options.nodeStyle,\n      label = options.label,\n      tooltip = options.tooltip;\n  var nodeView = chart.createView();\n  nodeView.data(nodesData); // 面\n\n  polygon({\n    chart: nodeView,\n    options: {\n      xField: X_FIELD,\n      yField: Y_FIELD,\n      seriesField: NODE_COLOR_FIELD,\n      polygon: {\n        style: nodeStyle\n      },\n      label: label,\n      tooltip: tooltip\n    }\n  });\n  return params;\n}\n/**\n * edgeGeometry配置\n * @param params 参数\n */\n\n\nfunction edgeGeometry(params) {\n  var chart = params.chart,\n      options = params.options;\n  var edgesData = params.ext.chordData.edgesData;\n  var edgeStyle = options.edgeStyle,\n      tooltip = options.tooltip;\n  var edgeView = chart.createView();\n  edgeView.data(edgesData); // edge\n\n  var edgeOptions = {\n    xField: X_FIELD,\n    yField: Y_FIELD,\n    seriesField: EDGE_COLOR_FIELD,\n    edge: {\n      style: edgeStyle,\n      shape: 'arc'\n    },\n    tooltip: tooltip\n  };\n  edge({\n    chart: edgeView,\n    options: edgeOptions\n  });\n  return params;\n}\n\nfunction animation(params) {\n  var chart = params.chart,\n      options = params.options;\n  var animation = options.animation; // 同时设置整个 view 动画选项\n\n  if (typeof animation === 'boolean') {\n    chart.animate(animation);\n  } else {\n    chart.animate(true);\n  } // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n\n\n  each(getAllGeometriesRecursively(chart), function (g) {\n    g.animate(animation);\n  });\n  return params;\n}\n/**\n * 弦图适配器\n * @param chart\n * @param options\n */\n\n\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(theme, transformData, coordinate, scale, axis, legend, tooltip, edgeGeometry, nodeGeometry, interaction, state, animation)(params);\n}","map":null,"metadata":{},"sourceType":"module"}