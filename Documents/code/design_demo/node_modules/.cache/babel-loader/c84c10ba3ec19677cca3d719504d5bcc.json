{"ast":null,"code":"import { deepAssign } from '../../utils';\nimport { getUnitPatternSize, initCanvas, drawBackground, getSymbolsPosition, transformMatrix, getPixelRatio } from './util';\n/**\n * dotPattern的默认配置\n */\n\nexport var defaultDotPatternCfg = {\n  size: 6,\n  padding: 2,\n  backgroundColor: 'transparent',\n  opacity: 1,\n  rotation: 0,\n  fill: '#fff',\n  fillOpacity: 0.5,\n  stroke: 'transparent',\n  lineWidth: 0,\n  isStagger: true\n};\n/**\n * 绘制圆点\n *\n * @param context\n * @param cfg\n * @param x 圆点中心坐标x\n * @param y 圆点中心坐标y\n */\n\nexport function drawDot(context, cfg, x, y) {\n  var size = cfg.size,\n      fill = cfg.fill,\n      lineWidth = cfg.lineWidth,\n      stroke = cfg.stroke,\n      fillOpacity = cfg.fillOpacity;\n  context.beginPath();\n  context.globalAlpha = fillOpacity;\n  context.fillStyle = fill;\n  context.strokeStyle = stroke;\n  context.lineWidth = lineWidth;\n  context.arc(x, y, size / 2, 0, 2 * Math.PI, false);\n  context.fill();\n\n  if (lineWidth) {\n    context.stroke();\n  }\n\n  context.closePath();\n}\n/**\n * 创建 dot pattern，返回 HTMLCanvasElement\n *\n * @param cfg\n * @returns HTMLCanvasElement\n */\n\nexport function createDotPattern(cfg) {\n  var dotCfg = deepAssign({}, defaultDotPatternCfg, cfg);\n  var size = dotCfg.size,\n      padding = dotCfg.padding,\n      isStagger = dotCfg.isStagger,\n      rotation = dotCfg.rotation; // 计算 画布大小，dots的位置\n\n  var unitSize = getUnitPatternSize(size, padding, isStagger);\n  var dots = getSymbolsPosition(unitSize, isStagger); // 初始化 patternCanvas\n\n  var canvas = initCanvas(unitSize, unitSize);\n  var ctx = canvas.getContext('2d'); // 绘制 background，dots\n\n  drawBackground(ctx, dotCfg, unitSize);\n\n  for (var _i = 0, dots_1 = dots; _i < dots_1.length; _i++) {\n    var _a = dots_1[_i],\n        x = _a[0],\n        y = _a[1];\n    drawDot(ctx, dotCfg, x, y);\n  }\n\n  var pattern = ctx.createPattern(canvas, 'repeat');\n\n  if (pattern) {\n    var dpr = getPixelRatio();\n    var matrix = transformMatrix(dpr, rotation);\n    pattern.setTransform(matrix);\n  }\n\n  return pattern;\n}","map":null,"metadata":{},"sourceType":"module"}