{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nexport var PassNode = /*#__PURE__*/function () {\n  function PassNode() {\n    _classCallCheck(this, PassNode);\n\n    this.name = void 0;\n    this.refCount = 0;\n    this.hasSideEffect = false;\n    this.devirtualize = [];\n    this.destroy = [];\n    this.reads = [];\n    this.writes = [];\n  }\n\n  _createClass(PassNode, [{\n    key: \"read\",\n    value: function read(handle) {\n      if (!this.reads.find(function (h) {\n        return h.index === handle.index;\n      })) {\n        this.reads.push(handle);\n      }\n\n      return handle;\n    }\n  }, {\n    key: \"sample\",\n    value: function sample(handle) {\n      this.read(handle); // TODO: 记录在 this.samples 中\n\n      return handle;\n    }\n  }, {\n    key: \"write\",\n    value: function write(fg, handle) {\n      var existed = this.writes.find(function (h) {\n        return h.index === handle.index;\n      });\n\n      if (existed) {\n        return handle;\n      }\n\n      var node = fg.getResourceNode(handle);\n      node.resource.version++;\n\n      if (node.resource.imported) {\n        this.hasSideEffect = true;\n      }\n\n      var r = fg.createResourceNode(node.resource);\n      var newNode = fg.getResourceNode(r);\n      newNode.writer = this;\n      this.writes.push(r);\n      return r;\n    }\n  }]);\n\n  return PassNode;\n}();","map":null,"metadata":{},"sourceType":"module"}