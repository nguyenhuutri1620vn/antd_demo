{"ast":null,"code":"export function diff(oldList, newList, key) {\n  const oldMap = makeKeyIndexAndFree(oldList, key);\n  const newMap = makeKeyIndexAndFree(newList, key);\n  const newFree = newMap.free;\n  const oldKeyIndex = oldMap.keyIndex;\n  const newKeyIndex = newMap.keyIndex;\n  const moves = [];\n  const children = [];\n  let i = 0;\n  let item;\n  let itemKey;\n  let freeIndex = 0;\n\n  while (i < oldList.length) {\n    item = oldList[i];\n    itemKey = item[key];\n\n    if (itemKey) {\n      // eslint-disable-next-line\n      if (!newKeyIndex.hasOwnProperty(itemKey)) {\n        children.push(null);\n      } else {\n        const newItemIndex = newKeyIndex[itemKey];\n        children.push(newList[newItemIndex]);\n      }\n    } else {\n      freeIndex += 1;\n      const freeItem = newFree[freeIndex];\n      children.push(freeItem || null);\n    }\n\n    i += 1;\n  }\n\n  const simulateList = children.slice(0);\n  i = 0;\n\n  while (i < simulateList.length) {\n    if (simulateList[i] === null) {\n      remove(i);\n      removeSimulate(i);\n    } else {\n      i += 1;\n    }\n  }\n\n  let j = i = 0;\n\n  while (i < newList.length) {\n    item = newList[i];\n    itemKey = item[key];\n    const simulateItem = simulateList[j];\n\n    if (simulateItem) {\n      const simulateItemKey = simulateItem[key];\n\n      if (itemKey === simulateItemKey) {\n        j += 1;\n      } else {\n        // eslint-disable-next-line\n        if (!oldKeyIndex.hasOwnProperty(itemKey)) {\n          insert(i, item);\n        } else {\n          const nextSimulateItem = simulateList[j + 1];\n\n          if (nextSimulateItem) {\n            const nextItemKey = nextSimulateItem[key];\n\n            if (nextItemKey === itemKey) {\n              remove(i);\n              removeSimulate(j);\n              j += 1;\n            } else {\n              insert(i, item);\n            }\n          }\n        }\n      }\n    } else {\n      insert(i, item);\n    }\n\n    i += 1;\n  }\n\n  let k = simulateList.length - j;\n\n  while ((j += 1) < simulateList.length) {\n    k -= 1;\n    remove(k + i);\n  }\n\n  function remove(index) {\n    const move = {\n      index,\n      type: 0,\n      item: null\n    };\n    moves.push(move);\n  }\n\n  function insert(index, item) {\n    const move = {\n      index,\n      item,\n      type: 1\n    };\n    moves.push(move);\n  }\n\n  function removeSimulate(index) {\n    simulateList.splice(index, 1);\n  }\n\n  return {\n    moves\n  };\n}\n\nfunction makeKeyIndexAndFree(list, key) {\n  const keyIndex = {};\n  const free = [];\n\n  for (let i = 0, len = list.length; i < len; i += 1) {\n    const item = list[i];\n    const itemKey = item[key];\n\n    if (itemKey) {\n      keyIndex[itemKey] = i;\n    } else {\n      free.push(item);\n    }\n  }\n\n  return {\n    keyIndex,\n    free\n  };\n}","map":null,"metadata":{},"sourceType":"module"}