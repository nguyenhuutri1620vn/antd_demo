{"ast":null,"code":"import { __decorate, __metadata } from \"tslib\";\nimport { singleton, contrib, Contribution } from 'mana-syringe';\nimport { DisposableCollection, Disposable } from '../common/disposable';\nimport { IFrontendApplicationContribution } from '../xflow-main/interface';\nimport { IMenuService, IMenuContribution } from './interface';\nlet MenuRegistry = class MenuRegistry {\n  constructor() {\n    /** disposables */\n    this.toDispose = new DisposableCollection();\n    /** menuMap */\n\n    this.menuMap = new Map();\n    /**\n     * 获取 menu\n     * @param menuId menuId\n     */\n\n    this.getMenu = menuId => {\n      return this.menuMap.get(menuId);\n    };\n    /**\n     * 注册一批可单独dispose的扩展项目\n     * @param externalRegisterFn IRegisterMenuFunction\n     */\n\n\n    this.registerDisposableMenu = externalRegisterFn => {\n      const toDispose = new DisposableCollection();\n      const disposableRegistry = {\n        registerMenu: config => {\n          const disposable = this.registerMenu(config);\n          toDispose.push(disposable);\n          return disposable;\n        }\n      };\n      externalRegisterFn(disposableRegistry);\n      this.toDispose.push(toDispose);\n      return toDispose;\n    };\n  }\n  /** app启动时，收集menu扩展点的注册项 */\n\n\n  onStart() {\n    const contributions = this.contributionProvider.getContributions();\n\n    for (const contribution of contributions) {\n      contribution.registerMenu(this);\n    }\n  }\n  /** app的停止逻辑 */\n\n\n  onStop() {\n    this.toDispose.dispose();\n  }\n  /**\n   * 注册 menu 类型\n   * @param config IMenu\n   */\n\n\n  registerMenu(config) {\n    this.menuMap.set(config.id, config);\n    return Disposable.create(() => this.menuMap.delete(config.id));\n  }\n\n};\n\n__decorate([contrib(IMenuContribution), __metadata(\"design:type\", Object)], MenuRegistry.prototype, \"contributionProvider\", void 0);\n\nMenuRegistry = __decorate([singleton({\n  contrib: [IFrontendApplicationContribution, IMenuService]\n})], MenuRegistry);\nexport { MenuRegistry };","map":null,"metadata":{},"sourceType":"module"}